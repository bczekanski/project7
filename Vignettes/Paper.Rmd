---
title: "Paper"
author: "Ben Czekanski"
date: "April 24, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(knitr)
library(ws.data)
library(dplyr)
library(lubridate)
library(zoo)
library(RcppRoll)
library(ggplot2)
library(reshape)
#Dont want to use reshape long term
library(tidyr)
library(project7)
```

```{r}
x <- get_data()

y <- x %>%
  filter(symbol == "AAPL"| symbol =="MSFT"| symbol =="GOOG")
### UNdo this

z <- compute_ret(y)

select_data <- function(x, j, k) {
  y <- x %>%
    filter(j.ret %in% j)
  z <- y %>%
    filter(k.ret %in% k)
  return(z)
}

make_table1 <- function(x) {
  x %>%
  na.omit() %>%
  group_by(j.ret, j.vol, k.ret) %>%
  mutate(prev.ret.rank = ntile(prev.returns, 10)) %>%
  group_by(j.ret, j.vol, k.ret, prev.ret.rank) %>%
  summarize_each(funs(mean), prev.returns, prev.vol, future.returns) %>%
  filter(prev.ret.rank == 1| prev.ret.rank == 5| prev.ret.rank == 10)
}

make_table2 <- function(x) {
  x %>%
    na.omit() %>%
    group_by(j.ret, j.vol, k.ret) %>%
    mutate(prev.ret.rank = ntile(prev.returns, 10)) %>%
    mutate(prev.vol.rank = ntile(prev.vol, 3)) %>%
    group_by(j.ret, j.vol, k.ret, prev.ret.rank, prev.vol.rank) %>%
    summarize_each(funs(mean), prev.returns, prev.vol, future.returns) %>%
    filter(prev.ret.rank == 1| prev.ret.rank == 5| prev.ret.rank == 10)
}

make_table3 <- function(x) {
  x %>%
    na.omit() %>%
    group_by(j.ret, j.vol, k.ret) %>%
    mutate(prev.ret.rank = ntile(prev.returns, 10)) %>%
    mutate(prev.vol.rank = ntile(prev.vol, 3)) %>%
    group_by(j.ret, j.vol, k.ret, prev.vol.rank, prev.ret.rank) %>%
    #summarize_each(funs(mean), prev.returns, prev.vol) %>%
    filter(prev.ret.rank == 1| prev.ret.rank == 10) %>%
    spread(key = prev.ret.rank, value = future.returns)
  
}

make_table6 <- function(x) {
  x %>%
  na.omit() %>%
  select(-k.ret, -future.returns) %>%
  group_by(j.ret, j.vol ) %>%
  mutate(prev.ret.rank = ntile(prev.returns, 10)) %>%
  mutate(size.rank = ntile(cap.usd, 10)) %>%
  mutate(prev.vol.rank = ntile(prev.vol, 3)) %>%
  group_by(j.ret, j.vol, prev.ret.rank, prev.vol.rank) %>%
  summarize_each(funs(mean), prev.returns, prev.vol, size.rank, cap.usd) %>%
  filter(prev.ret.rank == 1| prev.ret.rank == 5| prev.ret.rank == 10)
}
```





x <- get_data()
y <- x %>%
  filter(symbol == "AAPL"| symbol =="MSFT"| symbol =="GOOG")
### UNdo this
z <- compute_ret(y)


```{r}
tbl_1_data <- select_data(z, c(3, 6, 9, 12), c(3, 6, 9, 12))
tbl_1 <- make_table1(tbl_1_data)
kable(tbl_1)
# Table 2
tbl_2_data <- select_data(z, c(3, 6, 9, 12), c(12, 24, 36))
tbl_2 <- make_table1(tbl_2_data)
# needs size
kable(tbl_2)
# Table 3
tbl_3_data <- select_data(z, c(3, 6, 9, 12), c(3, 6, 9, 12))
tbl_3 <- make_table2(tbl_3_data)
kable(tbl_3)
# Table 4



# Table 5
tbl_5_data <- select_data(z, c(3, 6, 9, 12), c(12, 24, 36))
tbl_5 <- make_table2(tbl_5_data)
kable(tbl_5)
# Table 6
tbl_6_data <- select_data(z, c(3, 6, 9, 12), c(1:48))
tbl_6 <- make_table6(tbl_6_data)
kable(tbl_6)
# Needs Price and N

# Table 7








```
