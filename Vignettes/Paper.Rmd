---
title: "Paper"
author: "Ben Czekanski"
date: "April 24, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(knitr)
library(ws.data)
library(dplyr)
library(lubridate)
library(zoo)
library(RcppRoll)
library(ggplot2)
library(reshape)
#Dont want to use reshape long term
library(tidyr)
library(project7)
library(htmlTable)
```

```{r}
x <- get_data()

y <- x %>%
  filter(symbol == "AAPL"| symbol =="MSFT"| symbol =="GOOG" | symbol == "FSLR" | symbol == "AMZN" | symbol == "GAP" | symbol == "G.1" | symbol == "NSCN" | symbol == "NKE" | symbol == "NDAQ" | symbol == "PMI"| symbol == "ACS" | symbol == "ACV")
### UNdo this

z <- compute_ret(y)

z <- z %>%
  na.omit

w <- do_rank(z)

v <- select_data(w, c(3, 6, 9, 12), c(3, 6, 9, 12, 24, 36, 48, 60)) %>%
  filter(prev.ret.rank == 1| prev.ret.rank == 5| prev.ret.rank == 10) %>%
  group_by(j.ret, k.ret, prev.ret.rank, monthYear) %>%
  summarize_each(funs(mean), prev.returns, prev.vol, sz.rank, price, future.returns)
s <- v %>%
  select(j.ret, k.ret, prev.ret.rank, future.returns) %>%
  group_by(j.ret, k.ret, prev.ret.rank) %>%
  summarize(future.returns = mean(future.returns)) %>%
  spread(key = prev.ret.rank, value = future.returns) %>%
  mutate(`0` = `10` - `1`) %>%
  #select(j.ret, k.ret, diff) %>%
  group_by(j.ret, k.ret) %>%
  gather(key = prev.ret.rank, value = future.returns, `0`, `1`, `5`, `10`) %>%
  mutate(prev.ret.rank  = as.integer(prev.ret.rank))
d <- v %>%
  group_by(j.ret, k.ret, prev.ret.rank) %>%
  summarize_each(funs(mean), prev.returns, prev.vol, sz.rank, price, future.returns)
r <- left_join(s,d, by = c("j.ret", "k.ret", "prev.ret.rank", "future.returns"))  
# Spread ret rank out and calc diff then gather it back

  t <- r %>%
    #unite(c(7:12)) %>%
    spread(key = k.ret, value = future.returns) %>%
    #na.omit() %>%
    
    summarize_each(funs(mean), prev.returns, prev.vol, sz.rank, price, c(7:12)) %>%
    filter(prev.ret.rank == 1| prev.ret.rank == 5| prev.ret.rank == 10)
    








v <- tbl_one(w)
htmlTable(txtRound(v, 2))
```


    htmlTable(t,
              rgroup = c(3, 6, 9, 12),
              n.rgroup = c(4, 4, 4, 4)
              
              )

```


tbl_1_data <- select_data(v, c(3, 6, 9, 12), c(3, 6, 9, 12))
tbl_1 <- make_table1(tbl_1_data)
kable(tbl_1)
# Table 2
tbl_2_data <- select_data(z, c(3, 6, 9, 12), c(12, 24, 36))
tbl_2 <- make_table1(tbl_2_data)
# needs size
kable(tbl_2)
# Table 3
tbl_3_data <- select_data(z, c(3, 6, 9, 12), c(3, 6, 9, 12))
tbl_3 <- make_table2(tbl_3_data)
kable(tbl_3)
# Table 4



# Table 5
tbl_5_data <- select_data(z, c(3, 6, 9, 12), c(12, 24, 36))
tbl_5 <- make_table2(tbl_5_data)
kable(tbl_5)
# Table 6
tbl_6_data <- select_data(z, c(3, 6, 9, 12), c(1:48))
tbl_6 <- make_table6(tbl_6_data)
kable(tbl_6)
# Needs Price and N

# Table 7




